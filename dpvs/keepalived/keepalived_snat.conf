! Configuration File for Keepalived

global_defs {
    notification_email {
        qlb-devel@dev.qiyi.com
    }
    notification_email_from qlb-alarm@qiyi.com
    smtp_server 10.11.50.63
    smtp_connect_timeout 60
    router_id DPVS_DEVEL
}

virtual_server match SNAT {
    protocol TCP
    lb_algo rr
    lb_kind SNAT
    src-range 192.168.9.10-192.168.9.254
    oif dpdk0

    real_server 192.168.10.1 0 {
        weight 100
    }

    real_server 192.168.11.1 0 {
        weight 100
    }

    access_control acl1 {
        rule deny
        max_conn 10
        srange 192.168.9.11-192.168.9.240
        drange 0.0.0.0-0.0.0.0:80-80
    }

    access_control acl2 {
        rule deny
        max_conn 6
        srange 192.168.9.10
        drange 192.168.10.11:80
    }
}


MATCH1='proto=icmp,src-range=192.168.9.0-192.168.9.254,oif=dpdk0'
virtual_server match SNAT {
    protocol ICMP
    lb_algo rr
    lb_kind SNAT
    src-range 192.168.9.0-192.168.9.254
    oif dpdk0

    real_server 192.168.11.1 0 {
        weight 100
    }

    access_control acl1 {
        rule deny
        max_conn 0
        srange 192.168.9.1-192.168.9.240
    }

    access_control acl2 {
        rule permit
        max_conn 6
        srange 192.168.10.1
    }
}
